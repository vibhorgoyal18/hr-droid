{"version":3,"file":"wellwind-thanos-snap.umd.js.map","sources":["ng://@wellwind/thanos-snap/lib/thanos-snap.ts","ng://@wellwind/thanos-snap/wellwind-thanos-snap.ts"],"sourcesContent":["// to fix error: Cannot call a namespace ('html2canvas')\r\nimport * as html2canvas_ from 'html2canvas';\r\nimport { range } from 'ramda';\r\n\r\nconst html2canvas = html2canvas_;\r\n\r\nconst LAYERS = 32;\r\nconst TRANSITION_DURATION = 1.5;\r\nconst TRANSITION_DELAY = 1.35;\r\n\r\nconst sampler = (\r\n  layerImages: ImageData[],\r\n  sourceImgData: ImageData,\r\n  width: number,\r\n  height: number\r\n) => {\r\n  const layerCount = layerImages.length;\r\n  const repeat = 2;\r\n  range(0, width).forEach(x => {\r\n    range(0, height).forEach(y => {\r\n      range(0, repeat).forEach(n => {\r\n        const pieceIndex = Math.floor(\r\n          (layerCount * (Math.random() + (2 * x) / width)) / 3\r\n        );\r\n        const pixelPos = 4 * (y * width + x);\r\n        for (let rgbaIndex = 0; rgbaIndex < 4; rgbaIndex++) {\r\n          const dataPos = pixelPos + rgbaIndex;\r\n          layerImages[pieceIndex].data[dataPos] = sourceImgData.data[dataPos];\r\n        }\r\n      });\r\n    });\r\n  });\r\n};\r\n\r\nconst transformLayerCanvas = (canvas: HTMLCanvasElement) => {\r\n  const rotate1 = 15 * (Math.random() - 0.5);\r\n  const rotate2 = 15 * (Math.random() - 0.5);\r\n  const fac = 2 * Math.PI * (Math.random() - 0.5);\r\n  const translateX = 60 * Math.cos(fac);\r\n  const translateY = 30 * Math.sin(fac);\r\n\r\n  canvas.style.transform = `rotate(${rotate1}deg) translate(${translateX}px, ${translateY}px) rotate(${rotate2}deg)`;\r\n  canvas.style.opacity = '0';\r\n\r\n  const removeDelay = 1e3 * (TRANSITION_DURATION + 1 + Math.random());\r\n  setTimeout(() => canvas.remove(), removeDelay);\r\n};\r\n\r\n// fix retina problem\r\n// https://github.com/cburgmer/rasterizeHTML.js/blob/master/examples/retina.html\r\nconst backingScale = () => {\r\n  if (window.devicePixelRatio && window.devicePixelRatio > 1) {\r\n    return window.devicePixelRatio;\r\n  }\r\n  return 1;\r\n};\r\n\r\nexport const thanosRewind = (target: HTMLElement) =>\r\n  new Promise(resolve => {\r\n    target.style.opacity = '1';\r\n    target.style.visibility = 'visible';\r\n    resolve();\r\n  });\r\n\r\nexport const thanosSnap = (target: HTMLElement) =>\r\n  new Promise<{ rewind: () => {} }>(resolve => {\r\n    const effect = document.createElement('div');\r\n    effect.classList.add('thanos');\r\n    target.parentNode.insertBefore(effect, target);\r\n    const targetRect = target.getBoundingClientRect();\r\n\r\n    html2canvas(target).then((canvas: HTMLCanvasElement) => {\r\n      const context = canvas.getContext('2d');\r\n      effect.style.position = 'absolute';\r\n      effect.style.left = targetRect.left + 'px';\r\n      effect.style.top = targetRect.top + 'px';\r\n      effect.style.width = targetRect.width + 'px';\r\n      effect.style.height = targetRect.height + 'px';\r\n\r\n      const { width, height } = canvas;\r\n\r\n      // get element imageData\r\n      const imgData = context.getImageData(0, 0, width, height);\r\n\r\n      const layerImages = range(0, LAYERS).map(_ =>\r\n        context.createImageData(width, height)\r\n      );\r\n      sampler(layerImages, imgData, width, height);\r\n\r\n      layerImages.forEach((effectImage, index) => {\r\n        const newCanvas = document.createElement('canvas');\r\n\r\n        newCanvas.style.position = 'absolute';\r\n        newCanvas.style.transition = `all ${TRANSITION_DURATION}s`;\r\n\r\n        newCanvas.width = targetRect.width * backingScale();\r\n        newCanvas.height = targetRect.height * backingScale();\r\n\r\n        newCanvas.style.width = `${newCanvas.width / backingScale()}px`;\r\n        newCanvas.style.height = `${newCanvas.height / backingScale()}px`;\r\n\r\n        const newContext = newCanvas.getContext('2d');\r\n        newContext.putImageData(effectImage, 0, 0);\r\n\r\n        effect.appendChild(newCanvas);\r\n\r\n        const transitionDelay = TRANSITION_DELAY * (index / layerImages.length);\r\n        newCanvas.style.transitionDelay = `${transitionDelay}s`;\r\n\r\n        setTimeout(() => transformLayerCanvas(newCanvas), 0);\r\n      });\r\n\r\n      target.style.transition = `opacity ${TRANSITION_DURATION} ease`;\r\n      target.style.opacity = '0';\r\n\r\n      setTimeout(() => {\r\n        target.style.visibility = 'hidden';\r\n        effect.remove();\r\n        resolve({\r\n          rewind: () => thanosRewind(target)\r\n        });\r\n      }, 1e3 * TRANSITION_DURATION);\r\n    });\r\n  });\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["range"],"mappings":"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"}
